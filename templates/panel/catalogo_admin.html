{% extends 'panel/base_admin.html' %}

{% block title %}Cat√°logo - Panel Admin{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row">
    <!-- COLUMNA IZQUIERDA: NUEVA PEL√çCULA -->
    <div class="col-12 col-lg-3 mb-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title mb-3">Nueva pel√≠cula</h5>

          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="_accion" value="crear">

            <!-- T√≠tulo -->
            <div class="mb-3">
              <label class="form-label">T√≠tulo</label>
              {{ form.titulo }}
            </div>

            <!-- G√©nero / A√±o -->
            <div class="row">
              <div class="col-6 mb-3">
                <label class="form-label">G√©nero</label>
                {{ form.genero }}
              </div>
              <div class="col-6 mb-3">
                <label class="form-label">A√±o</label>
                {{ form.anio }}
              </div>
            </div>

            <!-- Precio arriendo -->
            <div class="mb-3">
              <label class="form-label">Precio de arriendo</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                {{ form.precio_arriendo }}
                <span class="input-group-text">CLP</span>
              </div>
            </div>

            <!-- Precio compra -->
            <div class="mb-3">
              <label class="form-label">Precio de compra</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                {{ form.precio_compra }}
                <span class="input-group-text">CLP</span>
              </div>
            </div>

            <!-- Rating / Disponible / Imagen / Descripci√≥n... -->
            <!-- (deja lo que ya ten√≠as, solo aseg√∫rate de usar los campos de form:
                 form.calificacion, form.disponible, form.imagen, form.descripcion ) -->

            <div class="form-check form-switch mb-3">
              {{ form.disponible }}
              <label class="form-check-label ms-2">Disponible</label>
            </div>

            <div class="mb-3">
              <label class="form-label">Imagen</label>
              {{ form.imagen }}
              <div class="form-text">Opcional. JPG/PNG</div>
            </div>

            <div class="mb-3">
              <label class="form-label">Descripci√≥n (opcional)</label>
              {{ form.descripcion }}
            </div>

            <div class="d-grid gap-2">
              <button class="btn btn-dark" type="submit">Agregar</button>
              <a href="{% url 'admin_catalogo' %}" class="btn btn-outline-secondary" type="button">
                Limpiar
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- COLUMNA DERECHA: TABLA -->
    <div class="col-12 col-lg-9">
      <!-- ‚Ä¶ buscador, etc ‚Ä¶ -->

      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Imagen</th>
              <th>T√≠tulo</th>
              <th>G√©nero</th>
              <th>A√±o</th>
              <th>Precio arriendo</th>
              <th>Precio compra</th>
              <th>Rating</th>
              <th>Disponible</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for p in peliculas %}
            <tr>

              <!-- MINIATURA -->
              <td>
                {% if p.imagen %}
                  <img src="{{ p.imagen.url }}" class="img-thumbnail" style="width:55px;height:55px;object-fit:cover;border-radius:8px;">
                {% else %}
                  <div style="width:55px;height:55px;background:#333;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#aaa;font-size:10px;">
                    No img
                  </div>
                {% endif %}
              </td>

              <!-- T√çTULO -->
              <td>{{ p.titulo }}</td>

              <!-- G√âNERO -->
              <td>{{ p.genero }}</td>

              <!-- A√ëO -->
              <td>{{ p.anio }}</td>

              <!-- PRECIO ARRIENDO -->
              <td>${{ p.precio_arriendo|floatformat:0 }}</td>

              <!-- PRECIO COMPRA -->
              <td>${{ p.precio_compra|floatformat:0 }}</td>

              <!-- RATING -->
              <td>{{ p.calificacion }}</td>

              <!-- DISPONIBLE -->
              <td>
                {% if p.disponible %}
                  <span class="badge bg-success">S√≠</span>
                {% else %}
                  <span class="badge bg-danger">No</span>
                {% endif %}
              </td>

              <!-- ACCIONES -->
              <td>
                <a href="{% url 'admin_pelicula_editar' p.id %}" class="btn btn-sm btn-outline-primary">
                  ‚úèÔ∏è
                </a>
                <a href="{% url 'admin_pelicula_eliminar' p.id %}" class="btn btn-sm btn-outline-danger">
                  üóë
                </a>
              </td>

            </tr>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" class="text-center text-muted">No hay pel√≠culas registradas.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>
{% endblock %}
