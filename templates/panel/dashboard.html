{% extends 'panel/base_admin.html' %}
{% load humanize %}

{% block title %}Dashboard - Panel Admin{% endblock %}
{% block nav_dashboard_active %}active{% endblock %}

{% block content %}
<div class="container-fluid py-3">

  <!-- Encabezado -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="mb-0">Dashboard</h3>
      <small class="text-muted">Resumen general de la actividad en CineMarket.</small>
    </div>
    <span class="badge bg-primary-subtle text-primary border border-primary">
      <i class="bi bi-lightning-charge-fill me-1"></i>
      Admin {{ request.user.username }}
    </span>
  </div>

  <!-- KPIs principales -->
  <div class="row g-3 mb-3">
    <!-- Películas -->
    <div class="col-sm-6 col-lg-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-muted small">Películas en catálogo</span>
            <span class="text-primary"><i class="bi bi-collection-play fs-5"></i></span>
          </div>
          <h3 class="fw-bold mb-0">{{ total_peliculas }}</h3>
          <small class="text-muted mt-1">Títulos disponibles para compra o arriendo.</small>
        </div>
      </div>
    </div>

    <!-- Transacciones -->
    <div class="col-sm-6 col-lg-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-muted small">Transacciones totales</span>
            <span class="text-success"><i class="bi bi-receipt-cutoff fs-5"></i></span>
          </div>
          <h3 class="fw-bold mb-0">{{ total_transacciones }}</h3>
          <small class="text-muted mt-1">
            Compras: {{ total_compras }} · Arriendos: {{ total_arriendos }}
          </small>
        </div>
      </div>
    </div>

    <!-- Ingresos -->
    <div class="col-sm-6 col-lg-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-muted small">Ingreso estimado</span>
            <span class="text-warning"><i class="bi bi-cash-stack fs-5"></i></span>
          </div>
          <h3 class="fw-bold mb-0">
            ${{ ingresos_totales|floatformat:0|intcomma }}
          </h3>
          <small class="text-muted mt-1">
            Compras: ${{ ingreso_compras|floatformat:0|intcomma }}
            · Arriendos: ${{ ingreso_arriendos|floatformat:0|intcomma }}
            · Devueltas: {{ total_devueltas }}
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección rápida -->
  <div class="row g-3">
    <div class="col-lg-8">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="mb-2">Accesos rápidos</h6>
          <p class="text-muted small mb-3">
            Gestiona las secciones principales del sistema desde aquí.
          </p>
          <div class="d-flex flex-wrap gap-2">
            <a href="{% url 'admin_catalogo' %}" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-collection-play me-1"></i> Ir al catálogo
            </a>
            <a href="{% url 'admin_reportes' %}" class="btn btn-outline-success btn-sm">
              <i class="bi bi-graph-up-arrow me-1"></i> Ver reportes
            </a>
            <a href="{% url 'admin_transacciones' %}" class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-receipt-cutoff me-1"></i> Transacciones recientes
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <h6 class="mb-2">Estado del sistema</h6>
          <ul class="list-unstyled small mb-0">
            <li class="mb-2">
              <i class="bi bi-check-circle-fill text-success me-2"></i>
              API y base de datos operativas.
            </li>
            <li class="mb-2">
              <i class="bi bi-play-circle-fill text-primary me-2"></i>
              Catálogo disponible para clientes.
            </li>
            <li>
              <i class="bi bi-shield-lock-fill text-secondary me-2"></i>
              Acceso restringido a administradores.
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}
